name: GitHub ➜ Gitee 同步 master & dev 分支

on:
  push:
    branches:
      - master
      - dev
  schedule:
    - cron: '0 4 * * *' # 每天凌晨 4 点自动同步
  workflow_dispatch:     # 手动触发按钮支持

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: 启用 SSH 推送
        uses: webfactory/ssh-agent@v0.8.0
        with:
          ssh-private-key: ${{ secrets.GITEE_RSA_PRIVATE_KEY }}

      - name: 信任 Gitee 主机密钥
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan gitee.com >> ~/.ssh/known_hosts

      - name: 克隆 GitHub 仓库
        run: |
          git clone --depth=1 --branch ${{ github.ref_name }} git@github.com:${{ secrets.UPSTREAM_REPO }} repo
          cd repo
          git remote set-url origin git@gitee.com:${{ secrets.GITEE_REPO }}
          git push origin ${{ github.ref_name }} --force
